#!/bin/bash

configure_options="$*"
platform=qt6-ucrt64
appname=`basename $PWD`

while : ; do
  case "$1" in
    "") break;;
    -platform|--platform)
        platform=$2; shift;;
    -appname|--appname)
        appname=$2; shift;;
    -help|--help)
        cat <<EOF
Usage: configure [options]
Options: [defaults in brackets after descriptions]
  --platform NAME         target platform (qt5-macx86, qt6-ucrt64, qt6-macm1) [default: qt6-ucrt64]
  --appname NAME          app name [default: $appname]
  --help                  print this message
EOF
	exit 0;;
    *) echo "Unknown option \"$1\"." 1>&2; exit 2;;
  esac
  shift
done

rm -f config
touch config
echo "# generated by ./configure $configure_options" >> config
echo "" >> config
case "$platform" in
  qt6-ucrt64)
      echo "PLATFORM_TYPE=windows" >> config;
      echo "PLATFORM=qt6-ucrt64" >> config;
      echo "QMAKE=/ucrt64/bin/qmake6.exe" >> config;
      echo "QMAKE_SPEC=" >> config;
      echo "WINDEPLOYQT=/ucrt64/bin/windeployqt6.exe" >> config;
      echo "EXTDLLS=../../extdlls/ucrt64" >> config;;
  qt5-macx86)
      echo "PLATFORM_TYPE=macos" >> config;
      echo "PLATFORM=qt5-macx86" >> config;
      echo "QMAKE=/Developer/Qt5.8/5.8/clang_64/bin/qmake" >> config;
      echo "QMAKE_SPEC=-spec macx-clang" >> config;
      echo "WINDEPLOYQT=unused_command" >> config;
      echo "EXTDLLS=unused_directory" >> config;;
  qt6-macm1)
      echo "PLATFORM_TYPE=macos" >> config;
      echo "PLATFORM=qt6-macm1" >> config;
      echo "QMAKE=~/Qt/6.3.1/macos/bin/qmake" >> config;
      echo "QMAKE_SPEC=-spec macx-clang CONFIG+=arm64" >> config;
      echo "WINDEPLOYQT=unused_command" >> config;
      echo "EXTDLLS=unused_directory" >> config;;
  *) 
      echo "Unknown platform: $platform";
      rm -f config;
      exit 3;;
esac
echo "APPNAME=$appname" >> config
if [ -e VERSION ]; then
    cat VERSION >> config;
fi

echo "** Wrote file ./config"
