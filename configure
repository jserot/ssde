#!/bin/bash

configure_options="$*"
platform=unix
arch='macosx64'
install_prefix=''
#install_bindir=''
#install_libdir=''
#install_docdir=''
#install_mandir=''

# Parse command-line arguments

while : ; do
  case "$1" in
    "") break;;
    -platform|--platform)
        platform=$2; shift;;
    -arch|--arch)
        arch=$2; shift;;
    -prefix|--prefix)
        install_prefix=$2; shift;;
    -help|--help)
        cat <<EOF
Usage: configure [options]
Options: [defaults in brackets after descriptions]
  --platform NAME         target platform (unix, macos or win32) [default: unix]
  --arch NAME             target architecture (for SystemC) [default: $arch]
  --prefix DIR            install executables, libs and docs in DIR [default: $prefix]
  --help                  print this message
EOF
	exit 0;;
    *) echo "Unknown option \"$1\"." 1>&2; exit 2;;
  esac
  shift
done

if [ -n "$install_prefix" ]; then
  install_bindir="$install_prefix/bin"
fi

case "$platform" in
  win32)
      if [ -z "$install_bindir" ]; then install_bindir='./build/bin'; fi;;
  *) 
      if [ -z "$install_bindir" ]; then install_bindir='/usr/local/bin'; fi;;
esac

# Generate the config file

rootdir=`dirname $0`

cd $rootdir
rm -f config
touch config

# Write options

version=`cat VERSION`
echo "# generated by ./configure $configure_options" >> config
echo "" >> config
echo "PLATFORM=$platform" >> config
echo "VERSION=$version" >> config
echo "" >> config
echo "# INSTALL PATHS" >> config
echo "INSTALL_BINDIR=$install_bindir" >> config

# Finish generated files

touch ./config-stamp

echo
echo "** Configuration summary **"
echo
echo "Directory where the distribution will be installed:"
echo "        binaries................   $install_bindir"
echo

echo "** Wrote file ./config"
